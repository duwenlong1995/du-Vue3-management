<template>
  <div class="table-container">
    <div class="operationSetting">
      <div>可编辑表格</div>
      <div>
        <!-- 刷新图标 -->
        <setIcon ref="setIconRef" @setting="refresh">
          <template #check>
            <svg
              t="1705067929729"
              class="icon"
              viewBox="0 0 1024 1024"
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
              p-id="11728"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              width="20"
              height="20"
            >
              <path
                d="M872.802928 755.99406 872.864326 755.99406 872.864326 755.624646Z"
                fill="#272536"
                p-id="11729"
              ></path>
              <path
                d="M922.268526 475.740168c-10.490935-10.727319-28.947286-10.815323-39.587624-0.366344l-18.368346 18.059308c-9.727549-206.461235-177.482227-367.192963-384.91458-367.192963-212.706473 0-385.751644 173.045171-385.751644 385.752668 0 212.720799 173.045171 385.766994 385.751644 385.766994 113.354698 0 220.62891-50.167586 293.924239-137.161916 3.2623-2.495844 5.907547-5.494131 7.907087-8.875135 0.26606-0.322341 0.557702-0.64673 0.853437-0.940418l1.880837-2.998287-0.618077-0.322341c1.26276-3.321652 1.851161-6.5246 1.851161-9.815553 0-16.077164-13.049201-29.155017-29.124318-29.155017-9.66922 0-18.721387 5.142114-23.982204 13.489222-62.806441 75.444273-154.911162 118.734218-252.691139 118.734218-181.244924 0-328.751443-147.447167-328.751443-328.721767 0-181.231621 147.506519-328.72279 328.751443-328.72279 180.070168 0 326.782601 145.509025 328.693114 325.122799l-32.709983-32.813337c-10.552334-10.623965-29.036313-10.653641-39.588647-0.086981-10.991332 10.933003-10.991332 28.712949-0.059352 39.660278l69.064982 69.226664c5.262864 5.320169 12.31549 8.229428 19.778462 8.229428l0.324388-0.028653 0.733711 0.23536c1.589195 0.38067 3.321652 0.851391 5.232165 0.851391 7.375991 0 14.34266-2.849908 19.633153-8.022721l71.445192-70.300113c5.348821-5.246491 8.346085-12.31549 8.405437-19.808138C930.410973 488.069985 927.529343 481.059314 922.268526 475.740168"
                fill="#231F20"
                p-id="11730"
              ></path>
            </svg>
          </template>
        </setIcon>
        <dropDown ref="dropDownRef">
          <!-- 外部触发drop下拉框 -->
          <template #icon>
            <setIcon
              ref="setIconRef"
              @setting="handleSettingClick"
              @checkSetting="handleCheckSettingClick"
            >
              <template #check v-if="unActive">
                <svg
                  t="1704972877577"
                  class="icon"
                  viewBox="0 0 1084 1024"
                  version="1.1"
                  xmlns="http://www.w3.org/2000/svg"
                  p-id="10561"
                  xmlns:xlink="http://www.w3.org/1999/xlink"
                  width="20"
                  height="20"
                >
                  <path
                    d="M1072.147851 406.226367c-6.331285-33.456782-26.762037-55.073399-52.047135-55.073399-0.323417 0-0.651455 0.003081-0.830105 0.009241l-4.655674 0c-73.124722 0-132.618162-59.491899-132.618162-132.618162 0-23.731152 11.447443-50.336101 11.546009-50.565574 13.104573-29.498767 3.023185-65.672257-23.427755-84.127081l-1.601687-1.127342-134.400039-74.661726-1.700252-0.745401c-8.753836-3.805547-18.334698-5.735272-28.479231-5.735272-20.789593 0-41.235746 8.344174-54.683758 22.306575-14.741683 15.216028-65.622973 58.649474-104.721083 58.649474-39.450789 0-90.633935-44.286652-105.438762-59.784516-13.518857-14.247316-34.128258-22.753199-55.127302-22.753199-9.945862 0-19.354234 1.861961-27.958682 5.531982l-1.746455 0.74078-139.141957 76.431283-1.643269 1.139662c-26.537186 18.437884-36.675557 54.579032-23.584845 84.062398 0.115506 0.264895 11.579891 26.725075 11.579891 50.634877 0 73.126262-59.491899 132.618162-132.618162 132.618162l-4.581749 0c-0.318797-0.00616-0.636055-0.01078-0.951772-0.01078-25.260456 0-45.672728 21.618157-52.002472 55.0811-0.462025 2.453354-11.313456 60.622322-11.313456 106.117939 0 45.494078 10.85143 103.659965 11.314996 106.119479 6.334365 33.458322 26.758957 55.076479 52.036353 55.076479 0.320337 0 0.651455-0.00616 0.842426-0.012321l4.655674 0c73.126262 0 132.618162 59.491899 132.618162 132.616622 0 23.760413-11.444363 50.333021-11.546009 50.565574-13.093793 29.474125-3.041666 65.646075 23.395414 84.151722l1.569346 1.093459 131.838879 73.726895 1.675611 0.7377c8.750757 3.84251 18.305437 5.790715 28.397607 5.790715 21.082208 0 41.676209-8.706094 55.0888-23.290689 18.724339-20.347588 69.527086-62.362616 107.04815-62.362616 40.625872 0 92.72537 47.100385 107.759669 63.583903 13.441852 14.831008 34.176001 23.689571 55.470741 23.695731l0.00616 0c9.895039 0 19.27877-1.883523 27.893999-5.598205l1.711034-0.73924 136.659342-75.531873 1.617088-1.128882c26.492523-18.456365 36.601633-54.600594 23.538642-84.016195-0.115506-0.267974-11.595291-27.082374-11.595291-50.67646 0-73.124722 59.49344-132.616622 132.618162-132.616622l4.517066-0.00154c0.300316 0.00616 0.599092 0.009241 0.899409 0.009241 25.331299-0.00154 45.785153-21.619697 52.107197-55.054918 0.112426-0.589852 11.325776-59.507301 11.325776-106.14104C1083.464388 466.640776 1072.609877 408.67356 1072.147851 406.226367zM377.486862 945.656142l-115.32764-64.487932c5.082277-13.052211 15.437801-43.51815 15.437801-75.017486 0-109.382917-84.176364-199.816642-192.587488-208.134635-2.647404-15.427021-8.873963-54.967133-8.873963-85.667166 0-30.65691 6.223479-70.232445 8.869343-85.671786 108.415744-8.311832 192.592108-98.745557 192.592108-208.134635 0-31.416171-10.300081-61.797405-15.371577-74.854236l122.721583-67.40331c0.003081 0 0.00462 0.00154 0.007701 0.00154 4.423121 4.518606 22.121764 22.080182 46.558275 39.493911 39.929754 28.46229 77.952885 42.894416 113.014434 42.894416 34.716571 0 72.437845-14.151831 112.115025-42.06431 24.282503-17.07953 41.896442-34.302288 46.308782-38.74543 0.009241-0.00154 0.018481-0.00462 0.026182-0.00616l118.301542 65.726159c-5.077657 13.055291-15.416239 43.499669-15.416239 74.958962 0 109.389077 84.174824 199.822802 192.590568 208.134635 2.645865 15.462442 8.872423 55.107281 8.872423 85.671786 0 30.687711-6.223479 70.241685-8.869343 85.673326C890.042174 606.334084 805.86427 696.767809 805.86427 806.158426c0 31.450053 10.317022 61.851309 15.393138 74.903519l-119.783103 66.198965c-5.168521-5.490399-22.603811-23.363073-46.740005-41.288109-40.701336-30.224145-79.662378-45.549521-115.800446-45.549521-35.79155 0-74.458435 15.038919-114.927219 44.694774C400.22004 922.554885 382.666163 940.255068 377.486862 945.656142zM731.271848 511.646647c0-105.803762-86.081448-191.88059-191.888289-191.88059-105.803762 0-191.88059 86.076827-191.88059 191.88059 0 105.803762 86.076827 191.882129 191.88059 191.882129C645.19194 703.528777 731.271848 617.450409 731.271848 511.646647zM539.383558 395.903184c63.825696 0 115.751164 51.922387 115.751164 115.743463 0 63.825696-51.925468 115.751164-115.751164 115.751164-63.821076 0-115.743463-51.925468-115.743463-115.751164C423.640095 447.824031 475.562482 395.903184 539.383558 395.903184z"
                    fill="#272636"
                    p-id="10562"
                  ></path>
                </svg>
              </template>
              <template #checked v-if="active">
                <svg
                  t="1704972877577"
                  class="icon"
                  viewBox="0 0 1084 1024"
                  version="1.1"
                  xmlns="http://www.w3.org/2000/svg"
                  p-id="10561"
                  xmlns:xlink="http://www.w3.org/1999/xlink"
                  width="20"
                  height="20"
                >
                  <path
                    d="M1072.147851 406.226367c-6.331285-33.456782-26.762037-55.073399-52.047135-55.073399-0.323417 0-0.651455 0.003081-0.830105 0.009241l-4.655674 0c-73.124722 0-132.618162-59.491899-132.618162-132.618162 0-23.731152 11.447443-50.336101 11.546009-50.565574 13.104573-29.498767 3.023185-65.672257-23.427755-84.127081l-1.601687-1.127342-134.400039-74.661726-1.700252-0.745401c-8.753836-3.805547-18.334698-5.735272-28.479231-5.735272-20.789593 0-41.235746 8.344174-54.683758 22.306575-14.741683 15.216028-65.622973 58.649474-104.721083 58.649474-39.450789 0-90.633935-44.286652-105.438762-59.784516-13.518857-14.247316-34.128258-22.753199-55.127302-22.753199-9.945862 0-19.354234 1.861961-27.958682 5.531982l-1.746455 0.74078-139.141957 76.431283-1.643269 1.139662c-26.537186 18.437884-36.675557 54.579032-23.584845 84.062398 0.115506 0.264895 11.579891 26.725075 11.579891 50.634877 0 73.126262-59.491899 132.618162-132.618162 132.618162l-4.581749 0c-0.318797-0.00616-0.636055-0.01078-0.951772-0.01078-25.260456 0-45.672728 21.618157-52.002472 55.0811-0.462025 2.453354-11.313456 60.622322-11.313456 106.117939 0 45.494078 10.85143 103.659965 11.314996 106.119479 6.334365 33.458322 26.758957 55.076479 52.036353 55.076479 0.320337 0 0.651455-0.00616 0.842426-0.012321l4.655674 0c73.126262 0 132.618162 59.491899 132.618162 132.616622 0 23.760413-11.444363 50.333021-11.546009 50.565574-13.093793 29.474125-3.041666 65.646075 23.395414 84.151722l1.569346 1.093459 131.838879 73.726895 1.675611 0.7377c8.750757 3.84251 18.305437 5.790715 28.397607 5.790715 21.082208 0 41.676209-8.706094 55.0888-23.290689 18.724339-20.347588 69.527086-62.362616 107.04815-62.362616 40.625872 0 92.72537 47.100385 107.759669 63.583903 13.441852 14.831008 34.176001 23.689571 55.470741 23.695731l0.00616 0c9.895039 0 19.27877-1.883523 27.893999-5.598205l1.711034-0.73924 136.659342-75.531873 1.617088-1.128882c26.492523-18.456365 36.601633-54.600594 23.538642-84.016195-0.115506-0.267974-11.595291-27.082374-11.595291-50.67646 0-73.124722 59.49344-132.616622 132.618162-132.616622l4.517066-0.00154c0.300316 0.00616 0.599092 0.009241 0.899409 0.009241 25.331299-0.00154 45.785153-21.619697 52.107197-55.054918 0.112426-0.589852 11.325776-59.507301 11.325776-106.14104C1083.464388 466.640776 1072.609877 408.67356 1072.147851 406.226367zM377.486862 945.656142l-115.32764-64.487932c5.082277-13.052211 15.437801-43.51815 15.437801-75.017486 0-109.382917-84.176364-199.816642-192.587488-208.134635-2.647404-15.427021-8.873963-54.967133-8.873963-85.667166 0-30.65691 6.223479-70.232445 8.869343-85.671786 108.415744-8.311832 192.592108-98.745557 192.592108-208.134635 0-31.416171-10.300081-61.797405-15.371577-74.854236l122.721583-67.40331c0.003081 0 0.00462 0.00154 0.007701 0.00154 4.423121 4.518606 22.121764 22.080182 46.558275 39.493911 39.929754 28.46229 77.952885 42.894416 113.014434 42.894416 34.716571 0 72.437845-14.151831 112.115025-42.06431 24.282503-17.07953 41.896442-34.302288 46.308782-38.74543 0.009241-0.00154 0.018481-0.00462 0.026182-0.00616l118.301542 65.726159c-5.077657 13.055291-15.416239 43.499669-15.416239 74.958962 0 109.389077 84.174824 199.822802 192.590568 208.134635 2.645865 15.462442 8.872423 55.107281 8.872423 85.671786 0 30.687711-6.223479 70.241685-8.869343 85.673326C890.042174 606.334084 805.86427 696.767809 805.86427 806.158426c0 31.450053 10.317022 61.851309 15.393138 74.903519l-119.783103 66.198965c-5.168521-5.490399-22.603811-23.363073-46.740005-41.288109-40.701336-30.224145-79.662378-45.549521-115.800446-45.549521-35.79155 0-74.458435 15.038919-114.927219 44.694774C400.22004 922.554885 382.666163 940.255068 377.486862 945.656142zM731.271848 511.646647c0-105.803762-86.081448-191.88059-191.888289-191.88059-105.803762 0-191.88059 86.076827-191.88059 191.88059 0 105.803762 86.076827 191.882129 191.88059 191.882129C645.19194 703.528777 731.271848 617.450409 731.271848 511.646647zM539.383558 395.903184c63.825696 0 115.751164 51.922387 115.751164 115.743463 0 63.825696-51.925468 115.751164-115.751164 115.751164-63.821076 0-115.743463-51.925468-115.743463-115.751164C423.640095 447.824031 475.562482 395.903184 539.383558 395.903184z"
                    fill="#1296db"
                    p-id="10562"
                  ></path>
                </svg>
              </template>
            </setIcon>
          </template>
          <!-- 内容插槽 -->
          <template #content>
            <div class="menu-list">
              <div
                class="menu-item"
                v-for="(menuItem, menuItemIndex) in columns"
                :key="menuItemIndex"
              >
                <!-- 拖动图标 -->
                <setIcon ref="setIconRef">
                  <template #check>
                    <svg
                      t="1705069264962"
                      class="icon"
                      viewBox="0 0 1024 1024"
                      version="1.1"
                      xmlns="http://www.w3.org/2000/svg"
                      p-id="12938"
                      xmlns:xlink="http://www.w3.org/1999/xlink"
                      width="15"
                      height="15"
                    >
                      <path
                        d="M243.0771072 96.27025341a66.2803595 66.2803595 0 1 0 132.560719 0 66.2803595 66.2803595 0 1 0-132.560719 0zM244.31986394 510.17729011a66.2803595 66.2803595 0 1 0 132.560719 0 66.2803595 66.2803595 0 1 0-132.560719 0zM244.31986394 934.48205822a66.2803595 66.2803595 0 1 0 132.560719 0 66.2803595 66.2803595 0 1 0-132.560719 0zM678.08339168 96.27025341a66.2803595 66.2803595 0 1 0 132.56071901 0 66.2803595 66.2803595 0 1 0-132.56071901 0zM679.32614842 510.17729011a66.2803595 66.2803595 0 1 0 132.56071901 0 66.2803595 66.2803595 0 1 0-132.56071901 0zM679.32614842 934.48205822a66.2803595 66.2803595 0 1 0 132.56071901 0 66.2803595 66.2803595 0 1 0-132.56071901 0z"
                        fill="#909399"
                        p-id="12939"
                      ></path>
                    </svg>
                  </template>
                </setIcon>
                <input type="checkbox" />
                {{ menuItem }}
              </div>
            </div>
          </template>
        </dropDown>
      </div>
    </div>
    <table class="table" ref="tableRef">
      <thead>
        <tr>
          <th class="thIndex" v-if="type">序号</th>
          <th
            v-for="(column, index) in columns"
            :key="index"
            :style="{ width: width[index] + '%' }"
            @mousedown="startDrag(index)"
            @mouseup="stopDrag"
            :class="{ 'is-dragging': index === draggingColumn }"
          >
            {{ column }}
            <div
              class="resize-handle"
              @mousedown="handleMouseDown($event, key)"
            ></div>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr
          v-for="(row, rowIndex) in tableData"
          :key="rowIndex"
          @contextmenu="selectRow(row)"
        >
          <td class="tdIndex" v-if="type">{{ tableData.indexOf(row) }}</td>
          <td
            v-for="(column, colIndex) in columns"
            :key="colIndex"
            :style="{ width: width[colIndex] + '%' }"
          >
            {{ row[column] }}
          </td>
        </tr>
        <!-- <tr v-for="(row, rowIndex) in tableData" :key="rowIndex">
          <td v-for="(column, colIndex) in columns" :key="colIndex">
            <template v-if="row.type === 'input'">
              <a-input
                v-model:value="editableInputData"
                style="margin: -5px 0"
              />
            </template>
            <template v-if="row.type === 'select'">
              <a-select
                v-model:value="editableSelectData"
                style="width: 120px"
                :options="editableSelectOptionsData"
              >
              </a-select>
            </template>
          </td>
        </tr> -->
      </tbody>
    </table>
    <pagination :current="3" :total="10" />
  </div>
</template>

<script setup>
import { reactive, toRefs, ref, defineEmits, onMounted } from "vue";
import useDragTable from "@/hooks/useDragTable.js";
import useTableResize from "@/hooks/useTableResize.js";
import setIcon from "../setIcon/setIcon.vue";
import pagination from "../pagination/pagination.vue";

const props = defineProps({
  columns: {
    type: Array,
    default: () => [],
  },
  tableData: {
    type: Array,
    default: () => [],
  },
  type: {
    type: Boolean,
    default: false,
  },
  width: {
    type: Array,
    default: () => [],
  },
});
const emits = defineEmits();
const selectRow = (row) => {
  emits("selectRow", row);
};
const editableInputData = ref("");
const editableSelectData = ref("");
const editableSelectOptionsData = reactive([]);
// 表格的设置
// const unCheckSetting = ref(true);
// const checkedSetting = ref(false);
// const unCheckIcon = () => {
//   checkedSetting = true;
// };
// const checkedIcon = () => {
//   unCheckSetting = false;
// };
const dropDownRef = ref(null);
const setIconRef = ref(null);
// 打开drop
const unActive = ref(true);
const active = ref(false);
const handleSettingClick = () => {
  unActive.value = false;
  active.value = true;
  dropDownRef.value.showDropDown = true;
};
// 关闭drop
const handleCheckSettingClick = () => {
  unActive.value = true;
  active.value = false;
  dropDownRef.value.showDropDown = false;
};
// 刷新表格数据
const refresh = () => {
  console.log("刷新了");
};
/**
 * 拖拽表头改列顺序hooks函数
 */
const { columns, startDrag, stopDrag, draggingColumn } = useDragTable(
  props.columns
);
/**
 * 拖拽表头改列宽hooks函数
 */
const tableRef = ref(null);
const { columnWidths, handleMouseDown } = useTableResize(tableRef);
</script>

<style lang="scss" scoped>
@import "./menuList.scss";
$nightColor: #141820;
$dayColor: #fff;
$dayTheadColor: #e5e7eb;
$dayBorderColor: #e5e7eb;
.table-container {
  .operationSetting {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    padding: 0 10px;
    div:nth-child(1) {
      padding-right: 10px;
    }
    div:nth-child(2) {
      display: flex;
      flex-direction: row;
    }
  }
  .table {
    width: 100%;
    margin-left: 0;
    text-align: center;
    border-collapse: collapse;
    font-size: 12px;
    background-color: $dayColor;
  }
  .table thead tr {
    background-color: $dayTheadColor;
  }
  .table th,
  .table td {
    border: 1px solid $dayBorderColor !important;
    padding: 0.35rem !important;
    font-size: 16px;
    vertical-align: middle !important;
  }
  .table tbody tr:hover {
    background-color: transparent;
    backdrop-filter: blur(30px);
    opacity: 0.5;
  }

  /* 添加拖拽时的样式 */
  th.is-dragging {
    background-color: #f0f0f0;
    animation: draggingAnimation 0.5s ease-in-out; /* 应用动画效果 */
  }
  @keyframes draggingAnimation {
    from {
      /* 起始样式 */
      /* 例如，起始位置的样式 */
    }
    to {
      /* 终止样式 */
      /* 例如，结束位置的样式 */
    }
  }
  /* 拖拽调整列宽的手柄样式 */
  .resize-handle {
    position: absolute;
    // bottom: 0;
    top: 70px;
    width: 10px;
    height: 40px;
    transform: translate(-10px);
    cursor: col-resize;
    // background-color: red;
    z-index: 1;
  }
  // 表格序号宽度样式
  .thIndex {
    width: 10%;
  }
  .tdIndex {
    width: 10%;
  }
}
</style>
